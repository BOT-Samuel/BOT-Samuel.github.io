<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Forca — Instrumentação</title>
  <style>
    :root{
      --bg: #0b1220;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --danger: rgba(255,90,90,.95);
      --ok: rgba(90,255,170,.95);
      --warn: rgba(255,200,90,.95);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --gap: 14px;
      --focus: rgba(110,170,255,.9);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(1100px 700px at 12% 10%, rgba(93, 163, 255, .22), transparent 65%),
        radial-gradient(900px 650px at 90% 12%, rgba(255, 140, 220, .14), transparent 60%),
        radial-gradient(900px 700px at 40% 92%, rgba(80, 255, 190, .12), transparent 55%),
        var(--bg);
      display:flex;
      align-items:stretch;
      justify-content:center;
      padding: 18px;
    }

    .app{
      width:min(1100px, 100%);
      display:flex;
      flex-direction:column;
      gap: var(--gap);
    }

    header{
      display:flex;
      gap: var(--gap);
      align-items:stretch;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand{
      flex: 1 1 280px;
      display:flex;
      flex-direction:column;
      gap:8px;
      padding: 16px 18px;
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
    }
    .brand h1{
      font-size: 18px;
      margin:0;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .pill{
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      color: var(--muted);
      border: 1px solid rgba(255,255,255,.12);
      white-space:nowrap;
    }
    .brand .sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
    }

    .stats{
      flex: 1 1 420px;
      display:grid;
      grid-template-columns: repeat(4, minmax(110px, 1fr));
      gap: 10px;
      padding: 14px;
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      align-items:stretch;
      min-width:min(520px, 100%);
    }

    .stat{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius2);
      padding: 10px 12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 6px;
    }
    .stat .label{
      font-size: 11px;
      color: var(--muted);
      letter-spacing:.2px;
      text-transform:uppercase;
    }
    .stat .value{
      font-size: 18px;
      font-weight: 700;
      letter-spacing:.3px;
    }
    .stat .hint{
      font-size: 12px;
      color: var(--muted);
    }

    main{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap: var(--gap);
      align-items:stretch;
    }

    .card{
      background: linear-gradient(180deg, var(--panel2), var(--panel));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(10px);
      overflow:hidden;
      min-height: 420px;
      display:flex;
      flex-direction:column;
    }

    .cardHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .cardHeader h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.3px;
      text-transform:uppercase;
      color: var(--muted);
      font-weight: 700;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      justify-content:flex-end;
    }

    button{
      font-family: inherit;
      appearance:none;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 13px;
      cursor:pointer;
      transition: transform .05s ease, background .2s ease, border-color .2s ease, opacity .2s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover{ background: rgba(255,255,255,.12); }
    button:active{ transform: translateY(1px); }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
    }
    button:focus-visible{
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }
    .btnPrimary{
      border-color: rgba(110,170,255,.35);
      background: rgba(110,170,255,.12);
    }
    .btnDanger{
      border-color: rgba(255,90,90,.35);
      background: rgba(255,90,90,.10);
    }
    .btnOk{
      border-color: rgba(90,255,170,.30);
      background: rgba(90,255,170,.09);
    }

    .leftBody{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 14px;
    }

    .hangArea{
      display:grid;
      grid-template-columns: 180px 1fr;
      gap: 14px;
      align-items:center;
    }

    .hangSvgWrap{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height: 180px;
    }

    svg{ width: 160px; height: 160px; }
    .part{ opacity:0; transition: opacity .2s ease; }
    .part.on{ opacity:1; }

    .wordWrap{
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      min-height: 180px;
    }

    .word{
      font-size: clamp(22px, 3.2vw, 34px);
      font-weight: 900;
      letter-spacing: .18em;
      line-height: 1.2;
      text-transform: uppercase;
      word-break: break-word;
    }

    .metaRow{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      align-items:center;
      justify-content:space-between;
    }

    .tag{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 12px;
      color: var(--muted);
      font-weight: 700;
    }

    .tag strong{ color: var(--text); font-weight: 900; }
    .tag.d1 strong{ color: var(--ok); }
    .tag.d2 strong{ color: var(--warn); }
    .tag.d3 strong{ color: rgba(255,140,255,.95); }

    .message{
      font-size: 13px;
      color: var(--muted);
      line-height:1.35;
    }
    .message .ok{ color: var(--ok); font-weight: 900; }
    .message .bad{ color: var(--danger); font-weight: 900; }
    .message .warn{ color: var(--warn); font-weight: 900; }

    /* MUDANÇA: Dica sempre visível */
    .hintBox{
      display: block; /* Força aparecer */
      margin-top: 6px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(110,170,255,.10);
      border: 1px solid rgba(110,170,255,.22);
      color: rgba(235,245,255,.92);
      font-size: 13px;
      line-height:1.35;
    }

    .rightBody{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .keyboard{
      display:grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 8px;
      padding: 10px;
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
    }
    .key{
      padding: 10px 0;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 900;
      letter-spacing:.2px;
      text-align:center;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      cursor:pointer;
      user-select:none;
    }
    .key:hover{ background: rgba(255,255,255,.12); }
    .key:active{ transform: translateY(1px); }
    .key.disabled{
      opacity:.35;
      cursor:not-allowed;
    }
    .key.good{
      border-color: rgba(90,255,170,.30);
      background: rgba(90,255,170,.09);
    }
    .key.bad{
      border-color: rgba(255,90,90,.35);
      background: rgba(255,90,90,.10);
    }

    .guesses{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.10);
      min-height: 54px;
      align-items:center;
    }
    .chip{
      font-size: 12px;
      font-weight: 900;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      color: var(--muted);
    }
    .chip.good{ color: rgba(225,255,238,.95); border-color: rgba(90,255,170,.30); background: rgba(90,255,170,.08); }
    .chip.bad{ color: rgba(255,235,235,.95); border-color: rgba(255,90,90,.32); background: rgba(255,90,90,.08); }

    .footnote{
      margin-top:auto;
      color: rgba(255,255,255,.55);
      font-size: 12px;
      line-height:1.35;
    }
    .kbd{
      display:inline-block;
      padding: 1px 7px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.8);
      font-weight: 900;
      font-size: 11px;
      letter-spacing:.2px;
    }

    .overlay{
      position: fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      z-index: 50;
    }
    .overlay.show{ display:flex; }

    .modal{
      width: min(520px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      box-shadow: 0 25px 70px rgba(0,0,0,.45);
      padding: 16px;
    }
    .modal h3{
      margin: 0 0 10px 0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .modal p{
      margin: 0 0 12px 0;
      color: rgba(255,255,255,.78);
      line-height: 1.4;
      font-size: 13px;
    }
    .modal .answer{
      margin: 10px 0 14px 0;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.14);
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      word-break: break-word;
    }
    .modal .modalActions{
      display:flex;
      gap: 10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    @media (max-width: 900px){
      main{ grid-template-columns: 1fr; }
      .stats{ grid-template-columns: repeat(2, minmax(0,1fr)); min-width: unset; }
      .hangArea{ grid-template-columns: 160px 1fr; }
      .keyboard{ grid-template-columns: repeat(8, minmax(0, 1fr)); }
    }

    @media (max-width: 420px){
      .hangArea{ grid-template-columns: 1fr; }
      .hangSvgWrap{ min-height: 150px; }
      svg{ width: 140px; height: 140px; }
      .keyboard{ grid-template-columns: repeat(7, minmax(0, 1fr)); }
      button{ padding: 10px 12px; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <section class="brand">
        <h1>Forca — Instrumentação <span class="pill" id="modePill">Dica sempre ativa • bônus por streak</span></h1>
        <p class="sub">
          Acerte letras para ganhar pontos. Errou? perde tentativas e pontos.
          A dica é exibida automaticamente.
        </p>
      </section>

      <section class="stats" aria-label="Placar">
        <div class="stat">
          <div class="label">Pontuação</div>
          <div class="value" id="score">0</div>
          <div class="hint">Bônus por sequência</div>
        </div>
        <div class="stat">
          <div class="label">Streak</div>
          <div class="value" id="streak">0</div>
          <div class="hint">Acertos seguidos</div>
        </div>
        <div class="stat">
          <div class="label">Penalidade</div>
          <div class="value" id="lives">—</div>
          <div class="hint">Erros restantes</div>
        </div>
        <div class="stat">
          <div class="label">Rodada</div>
          <div class="value" id="round">1</div>
          <div class="hint">Melhor: <span id="best">0</span></div>
        </div>
      </section>
    </header>

    <main>
      <section class="card" aria-label="Jogo">
        <div class="cardHeader">
          <h2>Palavra</h2>
          <div class="actions">
            <button id="btnSkip">Pular</button>
            <button class="btnOk" id="btnNew">Novo jogo</button>
          </div>
        </div>

        <div class="leftBody">
          <div class="hangArea">
            <div class="hangSvgWrap" aria-label="Forca">
              <svg viewBox="0 0 200 200" role="img" aria-label="Desenho da forca">
                <path d="M25 180H135" stroke="rgba(255,255,255,.75)" stroke-width="6" stroke-linecap="round"/>
                <path d="M55 180V25" stroke="rgba(255,255,255,.75)" stroke-width="6" stroke-linecap="round"/>
                <path d="M55 25H130" stroke="rgba(255,255,255,.75)" stroke-width="6" stroke-linecap="round"/>
                <path d="M130 25V45" stroke="rgba(255,255,255,.75)" stroke-width="6" stroke-linecap="round"/>

                <circle class="part" id="p1" cx="130" cy="62" r="16" stroke="rgba(255,255,255,.92)" stroke-width="6" fill="none"/>
                <path class="part" id="p2" d="M130 78V125" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
                <path class="part" id="p3" d="M130 95L110 112" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
                <path class="part" id="p4" d="M130 95L150 112" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
                <path class="part" id="p5" d="M130 125L112 155" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
                <path class="part" id="p6" d="M130 125L148 155" stroke="rgba(255,255,255,.92)" stroke-width="6" stroke-linecap="round"/>
              </svg>
            </div>

            <div class="wordWrap">
              <div class="metaRow">
                <div class="tag" id="diffTag">Dificuldade: <strong id="diffText">—</strong></div>
                <div class="tag">Erros: <strong id="misses">0</strong>/<strong id="maxMisses">6</strong></div>
              </div>

              <div class="word" id="maskedWord" aria-label="Palavra escondida">—</div>

              <div class="message" id="msg">
                Boa sorte!
              </div>

              <div class="hintBox" id="hintBox" aria-label="Dica"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="card" aria-label="Teclado">
        <div class="cardHeader">
          <h2>Teclado</h2>
          <div class="actions">
            <button class="btnDanger" id="btnGiveUp">Desistir</button>
          </div>
        </div>

        <div class="rightBody">
          <div class="keyboard" id="keyboard" aria-label="Teclado virtual"></div>

          <div class="guesses" aria-label="Letras tentadas" id="guesses">
            <span class="chip">Tente uma letra…</span>
          </div>

          <div class="footnote">
            No computador, você pode digitar no teclado. Use <span class="kbd">Enter</span> para próxima rodada quando terminar.
          </div>
        </div>
      </section>
    </main>

    <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Resultado da rodada">
      <div class="modal">
        <h3 id="ovTitle">—</h3>
        <p id="ovText">—</p>
        <div class="answer" id="ovAnswer">—</div>
        <div class="modalActions">
          <button id="ovClose">Fechar</button>
          <button class="btnPrimary" id="ovNext">Próxima</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Banco de Palavras: Mega Pack Instrumentação =====
    const WORDS = [
      // --- GRANDEZAS & VARIÁVEIS ---
      { a:"PRESSAO", c:"Força exercida sobre uma área (ex: psi, bar).", d:1 },
      { a:"TEMPERATURA", c:"Grau de agitação térmica molecular.", d:1 },
      { a:"VAZAO", c:"Quantidade de fluido que passa por tempo.", d:1 },
      { a:"NIVEL", c:"Altura de um fluido em um reservatório.", d:1 },
      { a:"DENSIDADE", c:"Massa por unidade de volume.", d:2 },
      { a:"VISCOSIDADE", c:"Resistência de um fluido ao escoamento.", d:2 },
      { a:"PH", c:"Potencial hidrogeniônico (acidez/alcalinidade).", d:1 },
      { a:"CONDUTIVIDADE", c:"Capacidade de conduzir corrente elétrica.", d:2 },
      { a:"TURBIDEZ", c:"Grau de transparência de um líquido.", d:2 },
      { a:"UMIDADE", c:"Quantidade de vapor d'água no ar.", d:1 },
      { a:"VOLTAGEM", c:"Diferença de potencial elétrico (Tensão).", d:1 },
      { a:"CORRENTE", c:"Fluxo ordenado de elétrons.", d:1 },
      { a:"RESISTENCIA", c:"Oposição à passagem da corrente.", d:1 },
      { a:"CAPACITANCIA", c:"Capacidade de armazenar carga elétrica.", d:2 },
      { a:"INDUTANCIA", c:"Propriedade de resistir a mudanças na corrente.", d:2 },
      { a:"FREQUENCIA", c:"Número de ciclos por segundo (Hz).", d:1 },
      { a:"POTENCIA", c:"Taxa de trabalho ou energia transferida (Watts).", d:1 },
      { a:"VACUO", c:"Pressão abaixo da atmosférica.", d:1 },
      { a:"ROTAÇÃO", c:"Velocidade angular (RPM).", d:1 },
      { a:"TORQUE", c:"Força de torção em um eixo.", d:2 },
      { a:"VIBRACAO", c:"Oscilação mecânica monitorada em máquinas.", d:2 },

      // --- UNIDADES DE MEDIDA ---
      { a:"PASCAL", c:"Unidade padrão SI para pressão.", d:2 },
      { a:"BAR", c:"Unidade de pressão (aprox 1 atm).", d:1 },
      { a:"PSI", c:"Libras por polegada quadrada.", d:1 },
      { a:"ATM", c:"Atmosfera padrão.", d:1 },
      { a:"TORR", c:"Unidade de vácuo (mm de mercúrio).", d:3 },
      { a:"CELSIUS", c:"Escala de temperatura centígrada.", d:1 },
      { a:"FAHRENHEIT", c:"Escala de temperatura usada nos EUA.", d:2 },
      { a:"KELVIN", c:"Escala de temperatura absoluta (termodinâmica).", d:2 },
      { a:"RANKINE", c:"Escala absoluta baseada no Fahrenheit.", d:3 },
      { a:"VOLT", c:"Unidade de tensão elétrica.", d:1 },
      { a:"AMPERE", c:"Unidade de corrente elétrica.", d:1 },
      { a:"OHM", c:"Unidade de resistência elétrica.", d:1 },
      { a:"WATT", c:"Unidade de potência.", d:1 },
      { a:"JOULE", c:"Unidade de energia ou trabalho.", d:2 },
      { a:"HERTZ", c:"Unidade de frequência.", d:1 },
      { a:"FARAD", c:"Unidade de capacitância.", d:3 },
      { a:"HENRY", c:"Unidade de indutância.", d:3 },
      { a:"SIEMENS", c:"Unidade de condutância elétrica.", d:3 },
      { a:"LITRO", c:"Unidade de volume.", d:1 },
      { a:"GALAO", c:"Unidade de volume imperial/US.", d:2 },
      { a:"METRO", c:"Unidade de comprimento.", d:1 },

      // --- INSTRUMENTOS & EQUIPAMENTOS ---
      { a:"TRANSMISSOR", c:"Envia o sinal da variável medida (4-20mA).", d:1 },
      { a:"SENSOR", c:"Detecta a variável física.", d:1 },
      { a:"INDICADOR", c:"Mostra o valor localmente (Display).", d:1 },
      { a:"CONTROLADOR", c:"Compara a variável com o setpoint e age.", d:1 },
      { a:"POSICIONADOR", c:"Controla a posição exata da válvula.", d:2 },
      { a:"CONVERSOR", c:"Muda o tipo de sinal (ex: I/P ou P/I).", d:2 },
      { a:"REGISTRADOR", c:"Grava o histórico da variável (papel ou digital).", d:2 },
      { a:"TOTALIZADOR", c:"Soma a vazão acumulada ao longo do tempo.", d:2 },
      { a:"MULTIMETRO", c:"Mede tensão, corrente e resistência.", d:1 },
      { a:"OSCILOSCOPIO", c:"Visualiza formas de onda de tensão.", d:3 },
      { a:"ALICATE", c:"Amperímetro que abraça o cabo (tipo Clamp).", d:2 },
      { a:"MEGOHMETRO", c:"Mede resistência de isolamento.", d:3 },
      { a:"DECADA", c:"Caixa de resistências para calibração.", d:3 },
      { a:"HANDHELD", c:"Configurador portátil (HART/Fieldbus).", d:2 },
      { a:"MANOMETRO", c:"Instrumento mecânico de indicação de pressão.", d:1 },
      { a:"TERMOMETRO", c:"Instrumento de indicação de temperatura.", d:1 },
      { a:"ROTAMETRO", c:"Medidor de vazão de área variável (tubo cônico).", d:2 },
      { a:"HIDROMETRO", c:"Medidor de consumo de água.", d:1 },
      { a:"PITOT", c:"Tubo para medir vazão por pressão dinâmica.", d:3 },
      { a:"ULTRASSOM", c:"Tecnologia de medição de nível sem contato.", d:2 },
      { a:"RADAR", c:"Medição de nível por ondas eletromagnéticas.", d:2 },
      { a:"CORIOLIS", c:"Medidor de vazão mássica de alta precisão.", d:3 },
      { a:"VORTEX", c:"Medidor de vazão baseado em vórtices.", d:3 },
      { a:"MAGNETICO", c:"Medidor de vazão para líquidos condutivos.", d:2 },
      { a:"PLACA", c:"Orifício usado para gerar pressão diferencial.", d:2 },
      { a:"VENTURI", c:"Tubo estrangulador para medir vazão.", d:3 },
      { a:"TERMOPAR", c:"Sensor de temperatura (Tipos J, K, T...).", d:2 },
      { a:"RTD", c:"Detector de temperatura a resistência (PT100).", d:2 },
      { a:"PT100", c:"Sensor de platina, 100 ohms a 0°C.", d:2 },
      { a:"NTC", c:"Thermistor com coeficiente negativo.", d:3 },
      { a:"PTC", c:"Thermistor com coeficiente positivo.", d:3 },
      { a:"STRAINGAGE", c:"Sensor de deformação (célula de carga).", d:3 },
      { a:"LVDT", c:"Transformador diferencial para medir posição linear.", d:3 },
      { a:"ENCODER", c:"Sensor de posição rotativa digital.", d:2 },
      { a:"TERMOSTATO", c:"Chave acionada por temperatura.", d:1 },
      { a:"PRESSOSTATO", c:"Chave acionada por pressão.", d:1 },
      { a:"CHAVE", c:"Dispositivo de fim de curso ou nível (Switch).", d:1 },

      // --- VÁLVULAS & ATUADORES ---
      { a:"VALVULA", c:"Dispositivo que regula o fluxo.", d:1 },
      { a:"ATUADOR", c:"Move a válvula (pneumático ou elétrico).", d:1 },
      { a:"GLOBO", c:"Tipo de válvula comum para controle preciso.", d:2 },
      { a:"ESFERA", c:"Válvula de bloqueio rápido (Ball Valve).", d:1 },
      { a:"BORBOLETA", c:"Válvula de ¼ de volta compacta.", d:1 },
      { a:"GAVETA", c:"Válvula para bloqueio (Gate Valve).", d:2 },
      { a:"RETENCAO", c:"Impede o fluxo reverso (Check Valve).", d:2 },
      { a:"SOLENOIDE", c:"Válvula acionada eletromagneticamente (On/Off).", d:2 },
      { a:"AGULHA", c:"Válvula para ajuste fino de fluxo pequeno.", d:2 },
      { a:"MEMBRANA", c:"Válvula usada em fluidos corrosivos/limpos.", d:2 },
      { a:"ALIVIO", c:"Abre para aliviar excesso de pressão.", d:2 },
      { a:"SEGURANCA", c:"Proteção final contra sobrepressão (PSV).", d:1 },
      { a:"PISTAO", c:"Tipo de atuador linear ou rotativo.", d:2 },
      { a:"MOLA", c:"Retorna o atuador para posição de falha.", d:1 },
      { a:"FOLE", c:"Vedação metálica flexível para haste de válvula.", d:3 },
      { a:"GAIOLA", c:"Elemento interno da válvula globo (Cage).", d:3 },
      { a:"OBTURADOR", c:"Peça móvel que veda a sede da válvula (Plug).", d:3 },
      { a:"SEDE", c:"Local onde o obturador assenta para vedar.", d:2 },
      { a:"CV", c:"Coeficiente de vazão da válvula.", d:3 },
      { a:"CAVITACAO", c:"Formação de bolhas que danifica a válvula.", d:3 },
      { a:"FLASHING", c:"Evaporação súbita do fluido na válvula.", d:3 },

      // --- CONTROLE & AUTOMAÇÃO ---
      { a:"CLP", c:"Controlador Lógico Programável (PLC).", d:1 },
      { a:"SDCD", c:"Sistema Digital de Controle Distribuído (DCS).", d:2 },
      { a:"SCADA", c:"Sistema de supervisão e aquisição de dados.", d:2 },
      { a:"IHM", c:"Interface Homem-Máquina (Tela de operação).", d:1 },
      { a:"PID", c:"Controle Proporcional, Integral e Derivativo.", d:2 },
      { a:"MALHA", c:"Circuito de controle fechado (Loop).", d:1 },
      { a:"SETPOINT", c:"Valor alvo do controle (SP).", d:1 },
      { a:"VARIAVEL", c:"O valor medido do processo (PV).", d:1 },
      { a:"ERRO", c:"Diferença entre SP e PV.", d:1 },
      { a:"GANHO", c:"Sensibilidade da ação de controle (Gain).", d:2 },
      { a:"RESET", c:"Ação integral (correção do erro acumulado).", d:2 },
      { a:"RATE", c:"Ação derivativa (antecipação).", d:2 },
      { a:"HISTERESE", c:"Diferença de caminho na ida e volta.", d:2 },
      { a:"DEADBAND", c:"Banda morta onde o controle não atua.", d:3 },
      { a:"OFFSET", c:"Erro estacionário permanente.", d:3 },
      { a:"FEEDBACK", c:"Realimentação do sinal de saída.", d:1 },
      { a:"INTERTRAVAMENTO", c:"Lógica de segurança para impedir operação insegura.", d:3 },
      { a:"BYPASS", c:"Caminho alternativo para manutenção.", d:2 },
      { a:"REMOTO", c:"Controle feito à distância.", d:1 },
      { a:"LOCAL", c:"Controle feito no campo.", d:1 },
      { a:"MANUAL", c:"Operador define a saída.", d:1 },
      { a:"AUTOMATICO", c:"Controlador define a saída.", d:1 },
      { a:"CASCATA", c:"Um controlador define o setpoint do outro.", d:3 },
      { a:"RATIO", c:"Controle de razão entre duas variáveis.", d:3 },
      { a:"FEEDFORWARD", c:"Controle antecipatório (malha aberta).", d:3 },

      // --- COMUNICAÇÃO & REDES ---
      { a:"HART", c:"Highway Addressable Remote Transducer.", d:1 },
      { a:"FIELDBUS", c:"Rede de campo digital (ex: Foundation).", d:2 },
      { a:"PROFIBUS", c:"Rede industrial comum (DP ou PA).", d:2 },
      { a:"MODBUS", c:"Protocolo mestre-escravo simples e popular.", d:2 },
      { a:"ETHERNET", c:"Padrão de rede física (cabos RJ45/Fibra).", d:1 },
      { a:"PROFINET", c:"Versão Ethernet do Profibus.", d:2 },
      { a:"TCP", c:"Protocolo de transporte (internet/intranet).", d:2 },
      { a:"IP", c:"Endereço de rede (Internet Protocol).", d:1 },
      { a:"RS232", c:"Padrão serial antigo ponto-a-ponto.", d:2 },
      { a:"RS485", c:"Padrão serial multiponto robusto.", d:2 },
      { a:"FIBRA", c:"Meio de transmissão óptica imune a ruído.", d:1 },
      { a:"WIRELESS", c:"Comunicação sem fio.", d:1 },
      { a:"BLUETOOTH", c:"Comunicação sem fio de curto alcance.", d:1 },
      { a:"GATEWAY", c:"Conversor entre protocolos diferentes.", d:2 },
      { a:"REPETIDOR", c:"Reforça o sinal para ir mais longe.", d:2 },
      { a:"TERMINADOR", c:"Resistor no fim da rede RS485/Fieldbus.", d:3 },
      { a:"TOPOLOGIA", c:"Layout da rede (Estrela, Barramento, Anel).", d:2 },
      { a:"MESTRE", c:"Dispositivo que inicia a comunicação.", d:2 },
      { a:"ESCRAVO", c:"Dispositivo que responde ao mestre.", d:2 },
      { a:"BAUDRATE", c:"Velocidade de transmissão de dados.", d:3 },
      { a:"PARIDADE", c:"Bit de verificação de erro simples.", d:3 },
      { a:"DD", c:"Device Description (arquivo de driver).", d:3 },
      { a:"DTM", c:"Device Type Manager (driver FDT).", d:3 },

      // --- SMAR & PRODUTOS ESPECÍFICOS ---
      { a:"LD301", c:"Transmissor de Pressão (HART) clássico Smar.", d:2 },
      { a:"LD302", c:"Transmissor de Pressão (Fieldbus).", d:2 },
      { a:"LD303", c:"Transmissor de Pressão (Profibus).", d:2 },
      { a:"LD290", c:"Transmissor de pressão manométrica (econômico).", d:2 },
      { a:"LD400", c:"Transmissor de alta performance Smar.", d:2 },
      { a:"FY301", c:"Posicionador de Válvulas (HART).", d:2 },
      { a:"FY400", c:"Posicionador avançado com diagnóstico.", d:2 },
      { a:"TP301", c:"Transmissor de Posição Smar.", d:2 },
      { a:"TT301", c:"Transmissor de Temperatura (HART).", d:2 },
      { a:"TT400", c:"Transmissor de Temperatura montagem em painel/trilho.", d:2 },
      { a:"DT301", c:"Transmissor de Densidade (Touché).", d:2 },
      { a:"RD400", c:"Transmissor de Nível por Onda Guiada (Radar).", d:2 },
      { a:"VC920", c:"Válvula de controle Smar.", d:3 },
      { a:"CONF401", c:"Software configurador HART da Smar.", d:2 },
      { a:"SYSCON", c:"Software configurador do System302.", d:2 },
      { a:"SYSTEM302", c:"Sistema de controle da Smar.", d:2 },
      { a:"LC700", c:"Controlador Lógico Programável Smar.", d:2 },
      { a:"DF100", c:"Controlador da família DF (Fieldbus).", d:3 },
      { a:"PS302", c:"Fonte de alimentação para Fieldbus.", d:3 },
      { a:"BT302", c:"Terminador de barramento Fieldbus.", d:3 },
      { a:"DEV", c:"Sigla para Dispositivo (Device) no configurador.", d:3 },
      { a:"TAG", c:"Identificação alfanumérica do instrumento.", d:1 },

      // --- CONCEITOS E FÍSICA ---
      { a:"RANGE", c:"Faixa de ajuste (Min a Max).", d:1 },
      { a:"SPAN", c:"Alcance (Máximo - Mínimo).", d:1 },
      { a:"ZERO", c:"Ajuste do início da faixa.", d:1 },
      { a:"TRIM", c:"Calibração fina (ajuste de ganho/zero digital).", d:2 },
      { a:"URL", c:"Limite Superior do Range (Upper Range Limit).", d:3 },
      { a:"LRL", c:"Limite Inferior do Range (Lower Range Limit).", d:3 },
      { a:"URV", c:"Valor Superior da Faixa calibrada (Upper Range Value).", d:3 },
      { a:"LRV", c:"Valor Inferior da Faixa calibrada (Lower Range Value).", d:3 },
      { a:"PRECISAO", c:"Grau de repetibilidade da medida.", d:2 },
      { a:"EXATIDAO", c:"Proximidade do valor verdadeiro (Accuracy).", d:2 },
      { a:"LINEARIDADE", c:"Desvio máximo de uma linha reta ideal.", d:2 },
      { a:"DERIVA", c:"Mudança do sinal ao longo do tempo (Drift).", d:3 },
      { a:"RUIDO", c:"Sinal indesejado sobreposto ao sinal real.", d:2 },
      { a:"FILTRO", c:"Atenua o ruído do sinal (Damping).", d:2 },
      { a:"DAMPING", c:"Amortecimento do sinal de saída.", d:2 },
      { a:"CALIBRACAO", c:"Comparação com um padrão conhecido.", d:1 },
      { a:"AJUSTE", c:"Correção do erro encontrado na calibração.", d:1 },
      { a:"PADRAO", c:"Referência de alta precisão para calibração.", d:2 },
      { a:"RASTREABILIDADE", c:"Cadeia de calibrações até o padrão nacional.", d:3 },
      { a:"HIDROSTATICA", c:"Pressão exercida por uma coluna de líquido.", d:2 },
      { a:"BERNOULLI", c:"Princípio físico da conservação de energia nos fluidos.", d:3 },
      { a:"SEEBECK", c:"Efeito físico que gera tensão no termopar.", d:3 },
      { a:"PIEZOELETRICO", c:"Cristal que gera tensão quando pressionado.", d:3 },
      { a:"CAPACITIVO", c:"Tipo de sensor de pressão comum (Célula).", d:2 },
      { a:"HALL", c:"Efeito usado em sensores magnéticos.", d:3 },

      // --- HARDWARE & MATERIAIS ---
      { a:"INOX", c:"Aço resistente à corrosão (304, 316).", d:1 },
      { a:"HASTELLOY", c:"Liga especial para alta corrosão.", d:3 },
      { a:"MONEL", c:"Liga resistente à água salgada e HF.", d:3 },
      { a:"TANTALO", c:"Metal nobre usado em diafragmas ácidos.", d:3 },
      { a:"OURO", c:"Usado em diafragmas para proteção de hidrogênio.", d:2 },
      { a:"CERAMICA", c:"Material isolante ou sensor de alta dureza.", d:2 },
      { a:"SILICONE", c:"Óleo de enchimento padrão.", d:2 },
      { a:"GLICERINA", c:"Líquido usado para amortecer manômetros.", d:2 },
      { a:"FLANGE", c:"Disco de conexão com furos para parafusos.", d:1 },
      { a:"ROSCA", c:"Conexão giratória (NPT, BSP).", d:1 },
      { a:"NPT", c:"Rosca cônica americana.", d:2 },
      { a:"BSP", c:"Rosca paralela britânica (Gás).", d:2 },
      { a:"ORING", c:"Anel de vedação de borracha.", d:1 },
      { a:"GAXETA", c:"Vedação trançada para hastes ou flanges.", d:2 },
      { a:"PARAFUSO", c:"Fixador roscado.", d:1 },
      { a:"PORCA", c:"Peça que fixa o parafuso.", d:1 },
      { a:"ARRUELA", c:"Disco usado sob a porca/parafuso.", d:1 },
      { a:"SUPORTE", c:"Peça para fixar o instrumento no tubo (Bracket).", d:1 },
      { a:"CONDUITE", c:"Tubo para passagem de cabos elétricos.", d:1 },
      { a:"PRENSA", c:"Peça que veda a entrada do cabo (Prensa-cabos).", d:2 },
      { a:"CABO", c:"Condutor elétrico isolado.", d:1 },
      { a:"BLINDAGEM", c:"Proteção contra interferência (Shield).", d:2 },
      { a:"TERRA", c:"Conexão de segurança elétrica (GND).", d:1 },
      { a:"FUSIVEL", c:"Proteção contra curto-circuito (queima).", d:1 },
      { a:"DISJUNTOR", c:"Chave automática de proteção elétrica.", d:1 },
      { a:"RELE", c:"Chave acionada eletricamente.", d:1 },
      { a:"FONTE", c:"Fornece energia DC (ex: 24V).", d:1 },
      { a:"BATERIA", c:"Fonte de energia química armazenada.", d:1 },
      { a:"DISPLAY", c:"Tela LCD do instrumento.", d:1 },
      { a:"CARCACA", c:"Corpo do instrumento (Housing).", d:1 },
      { a:"MANIFOLD", c:"Bloco de válvulas para transmissor.", d:2 },
      { a:"CAPILAR", c:"Tubo fino para selo remoto.", d:2 },
      { a:"POTE", c:"Selo líquido para proteger transmissor.", d:3 },
      { a:"PURGA", c:"Limpeza ou fluxo constante para desobstruir.", d:3 },

      // --- SEGURANÇA & NORMAS ---
      { a:"INMETRO", c:"Certificação brasileira obrigatória.", d:1 },
      { a:"ATEX", c:"Norma europeia para atmosferas explosivas.", d:2 },
      { a:"IEC", c:"Comissão Eletrotécnica Internacional.", d:2 },
      { a:"ISA", c:"Sociedade Internacional de Automação.", d:2 },
      { a:"ABNT", c:"Associação Brasileira de Normas Técnicas.", d:2 },
      { a:"NR10", c:"Norma brasileira de segurança em eletricidade.", d:2 },
      { a:"NR12", c:"Norma de segurança em máquinas.", d:2 },
      { a:"SIL", c:"Nível de Integridade de Segurança (1 a 4).", d:3 },
      { a:"SIS", c:"Sistema Instrumentado de Segurança.", d:3 },
      { a:"ESD", c:"Parada de Emergência (Emergency Shutdown).", d:2 },
      { a:"EX", c:"Marcação para equipamentos à prova de explosão.", d:1 },
      { a:"IP67", c:"Grau de proteção contra poeira e imersão.", d:2 },
      { a:"ZONA", c:"Classificação de área de risco (0, 1, 2).", d:2 },
      { a:"INTRINSECA", c:"Segurança por limitação de energia (Ex i).", d:3 },
      { a:"PROVA", c:"Invólucro capaz de conter explosão (Ex d).", d:3 },
      { a:"LOTO", c:"Lockout/Tagout (Bloqueio e Etiquetagem).", d:2 },
      { a:"EPI", c:"Equipamento de Proteção Individual.", d:1 },

      // --- MISCELÂNEA TÉCNICA ---
      { a:"ALIMENTACAO", c:"Energia fornecida ao equipamento.", d:1 },
      { a:"SINAL", c:"Informação transmitida eletricamente.", d:1 },
      { a:"DIGITAL", c:"Sinal em bits (0 e 1).", d:1 },
      { a:"ANALOGICO", c:"Sinal contínuo (ex: 4-20mA).", d:1 },
      { a:"INPUT", c:"Entrada de sinal.", d:1 },
      { a:"OUTPUT", c:"Saída de sinal.", d:1 },
      { a:"INTERFACE", c:"Conexão entre dois sistemas.", d:1 },
      { a:"SERIAL", c:"Transmissão de dados bit a bit.", d:2 },
      { a:"PARALELO", c:"Transmissão simultânea de dados.", d:2 },
      { a:"FIRMWARE", c:"Software embarcado no hardware.", d:2 },
      { a:"HARDWARE", c:"Parte física do equipamento.", d:1 },
      { a:"SOFTWARE", c:"Parte lógica/programação.", d:1 },
      { a:"LOOP", c:"Malha de corrente ou controle.", d:1 },
      { a:"JUMPER", c:"Pequena ponte para configurar circuito.", d:2 },
      { a:"DIPSWITCH", c:"Conjunto de chavinhas para configuração.", d:2 },
      { a:"LED", c:"Diodo Emissor de Luz.", d:1 },
      { a:"LCD", c:"Display de Cristal Líquido.", d:1 },
      { a:"TOUCH", c:"Tela sensível ao toque.", d:1 },
      { a:"USB", c:"Barramento Serial Universal.", d:1 },
      { a:"WIFI", c:"Rede local sem fio.", d:1 },
      { a:"NUVEM", c:"Armazenamento/processamento remoto (Cloud).", d:1 },
      { a:"INDUSTRIA", c:"Local de aplicação da instrumentação.", d:1 },
      { a:"FABRICA", c:"Unidade de produção.", d:1 },
      { a:"USINA", c:"Unidade de geração (ex: Cana, Energia).", d:1 },
      { a:"OFFSHORE", c:"Operação em alto mar (Plataformas).", d:2 },
      { a:"ONSHORE", c:"Operação em terra.", d:2 },
      { a:"STARTUP", c:"Partida da planta ou equipamento.", d:2 },
      { a:"SHUTDOWN", c:"Parada da planta.", d:2 },
      { a:"COMISSIONAMENTO", c:"Testes finais antes da operação.", d:3 },
      { a:"MANUTENCAO", c:"Ato de reparar ou conservar.", d:1 },
      { a:"PREVENTIVA", c:"Manutenção agendada para evitar falhas.", d:2 },
      { a:"CORRETIVA", c:"Manutenção após a falha.", d:2 },
      { a:"PREDITIVA", c:"Manutenção baseada na condição real.", d:2 }
    ];

    // ===== Configurações de jogo =====
    const MAX_MISSES = 6;

    // Pontuação
    const SCORE = {
      baseHit: 8,
      baseMiss: 7,
      hintCost: 0,       // Dica é grátis agora
      roundWinBonus: 20,
      giveUpCost: 15
    };

    // ===== Utilidades =====
    const $ = (id) => document.getElementById(id);

    function normalizeAnswer(str){
      return str.toUpperCase().replace(/\s+/g,'');
    }

    function displayAnswer(entry){
      if(entry.a === "SELOREMOTO") return "SELO REMOTO";
      return entry.a.toUpperCase();
    }

    function difficultyLabel(d){
      if(d === 1) return "Fácil";
      if(d === 2) return "Médio";
      return "Difícil";
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    // ===== Estado =====
    let bag = [];
    let round = 1;
    let score = 0;
    let streak = 0;

    let entry = null;
    let answerShown = "";
    let answerNorm = "";
    let guessed = new Set();
    let good = new Set();
    let bad = new Set();
    let misses = 0;
    let locked = false;

    const bestKey = "forca_best_v1";
    let best = Number(localStorage.getItem(bestKey) || 0);

    // ===== UI refs =====
    const elScore = $("score");
    const elStreak = $("streak");
    const elLives = $("lives");
    const elRound = $("round");
    const elBest = $("best");
    const elMisses = $("misses");
    const elMaxMisses = $("maxMisses");
    const elMasked = $("maskedWord");
    const elMsg = $("msg");
    const elHintBox = $("hintBox");
    const elDiffText = $("diffText");
    const elDiffTag = $("diffTag");
    const elKeyboard = $("keyboard");
    const elGuesses = $("guesses");

    const btnSkip = $("btnSkip");
    const btnNew = $("btnNew");
    const btnGiveUp = $("btnGiveUp");

    const overlay = $("overlay");
    const ovTitle = $("ovTitle");
    const ovText = $("ovText");
    const ovAnswer = $("ovAnswer");
    const ovClose = $("ovClose");
    const ovNext = $("ovNext");

    function buildBag(){
      bag = WORDS.map((_,i)=>i);
      for(let i=bag.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [bag[i], bag[j]] = [bag[j], bag[i]];
      }
    }

    function pickNextEntry(){
      if(bag.length === 0) buildBag();
      const idx = bag.pop();
      return WORDS[idx];
    }

    function resetRound(newRound = true){
      locked = false;
      entry = pickNextEntry();
      answerShown = displayAnswer(entry);
      answerNorm = normalizeAnswer(answerShown);

      guessed = new Set();
      good = new Set();
      bad = new Set();
      misses = 0;

      if(newRound) round += 1;

      // Exibir dica imediatamente (sem custo)
      elHintBox.textContent = entry.c;

      for(const ch of answerShown.toUpperCase()){
        if(ch === " " || (ch >= "0" && ch <= "9")){
          guessed.add(ch);
          good.add(ch);
        }
      }

      renderAll(true);
    }

    function startNewGame(){
      buildBag();
      round = 1;
      score = 0;
      streak = 0;
      best = Number(localStorage.getItem(bestKey) || 0);
      entry = pickNextEntry();
      answerShown = displayAnswer(entry);
      answerNorm = normalizeAnswer(answerShown);

      guessed = new Set();
      good = new Set();
      bad = new Set();
      misses = 0;
      locked = false;

      // Exibir dica
      elHintBox.textContent = entry.c;

      for(const ch of answerShown.toUpperCase()){
        if(ch === " " || (ch >= "0" && ch <= "9")){
          guessed.add(ch);
          good.add(ch);
        }
      }

      renderAll(true);
    }

    function maskedWord(){
      const up = answerShown.toUpperCase();
      let out = "";
      for(const ch of up){
        if(ch === " "){
          out += "  ";
        } else if(guessed.has(ch)){
          out += ch + " ";
        } else {
          out += "_ ";
        }
      }
      return out.trimEnd();
    }

    function isWin(){
      for(const ch of answerShown.toUpperCase()){
        if(ch === " ") continue;
        if(!guessed.has(ch)) return false;
      }
      return true;
    }

    function updateHangman(){
      for(let i=1;i<=MAX_MISSES;i++){
        const part = $("p"+i);
        part.classList.toggle("on", misses >= i);
      }
    }

    function setMessage(type, text){
      if(type === "ok") elMsg.innerHTML = `<span class="ok">?</span> ${text}`;
      else if(type === "bad") elMsg.innerHTML = `<span class="bad">?</span> ${text}`;
      else if(type === "warn") elMsg.innerHTML = `<span class="warn">!</span> ${text}`;
      else elMsg.textContent = text;
    }

    function renderKeyboard(){
      const keys = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");
      elKeyboard.innerHTML = "";
      keys.forEach(k=>{
        const b = document.createElement("div");
        b.className = "key";
        b.textContent = k;
        if(guessed.has(k)){
          b.classList.add("disabled");
          if(good.has(k)) b.classList.add("good");
          if(bad.has(k)) b.classList.add("bad");
        }
        b.setAttribute("role","button");
        b.setAttribute("tabindex","0");
        b.setAttribute("aria-label", "Tecla " + k);
        b.addEventListener("click", ()=> tryGuess(k));
        b.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " ") tryGuess(k);
        });
        elKeyboard.appendChild(b);
      });
    }

    function renderGuesses(){
      const chips = [];
      if(good.size > 0){
        [...good].sort().forEach(ch=>{
          if(ch === " ") return;
          chips.push(`<span class="chip good">${ch}</span>`);
        });
      }
      if(bad.size > 0){
        [...bad].sort().forEach(ch=>{
          chips.push(`<span class="chip bad">${ch}</span>`);
        });
      }
      elGuesses.innerHTML = chips.length ? chips.join("") : `<span class="chip">Tente uma letra…</span>`;
    }

    function renderStats(){
      elScore.textContent = score;
      elStreak.textContent = streak;
      elLives.textContent = (MAX_MISSES - misses);
      elRound.textContent = round;
      elBest.textContent = best;

      elMisses.textContent = misses;
      elMaxMisses.textContent = MAX_MISSES;

      const d = entry?.d ?? 1;
      elDiffText.textContent = difficultyLabel(d);
      elDiffTag.classList.remove("d1","d2","d3");
      elDiffTag.classList.add(d === 1 ? "d1" : d === 2 ? "d2" : "d3");

      btnGiveUp.disabled = locked;
      btnSkip.disabled = locked;
    }

    function renderAll(quiet=false){
      elMasked.textContent = maskedWord();
      renderStats();
      renderKeyboard();
      renderGuesses();
      updateHangman();
    }

    function scoreHit(entryDifficulty){
      const gain = (SCORE.baseHit + 2*entryDifficulty) + (streak * 2);
      score += gain;
      return gain;
    }

    function scoreMiss(entryDifficulty){
      const loss = (SCORE.baseMiss + 2*entryDifficulty);
      score -= loss;
      return loss;
    }

    function winBonus(entryDifficulty){
      const livesLeft = (MAX_MISSES - misses);
      const bonus = (SCORE.roundWinBonus * entryDifficulty) + (livesLeft * 3);
      score += bonus;
      return bonus;
    }

    function showOverlay(title, text, answer){
      ovTitle.textContent = title;
      ovText.textContent = text;
      ovAnswer.textContent = answer.toUpperCase();
      overlay.classList.add("show");
    }
    function hideOverlay(){
      overlay.classList.remove("show");
    }

    function endRound(win){
      locked = true;

      if(score > best){
        best = score;
        localStorage.setItem(bestKey, String(best));
      }

      const shown = answerShown;
      if(win){
        const bonus = winBonus(entry.d);
        setMessage("ok", `Você concluiu a palavra! Bônus de rodada: +${bonus} pts.`);
        showOverlay("Você venceu!", `Bônus aplicado: +${bonus} pts. Aperte “Próxima” para continuar.`, shown);
      } else {
        setMessage("bad", `Você perdeu a rodada. A palavra era: ${shown}.`);
        showOverlay("Você perdeu!", `Sem problemas — próxima rodada já já.`, shown);
      }

      renderAll(true);
    }

    function tryGuess(ch){
      if(locked) return;
      ch = String(ch || "").toUpperCase();

      if(!/^[A-Z0-9]$/.test(ch)) return;
      if(guessed.has(ch)) return;

      guessed.add(ch);

      const inAnswer = answerNorm.includes(ch);
      if(inAnswer){
        good.add(ch);
        const gain = scoreHit(entry.d);
        streak += 1;
        setMessage("ok", `Acertou "${ch}"! +${gain} pts (streak ${streak}).`);
      } else {
        bad.add(ch);
        misses += 1;
        const loss = scoreMiss(entry.d);
        streak = 0;
        setMessage("bad", `Errou "${ch}". -${loss} pts. Penalidade: ${MAX_MISSES - misses} tentativas restantes.`);
      }

      elMasked.textContent = maskedWord();
      renderAll(true);

      if(isWin()){
        endRound(true);
        return;
      }
      if(misses >= MAX_MISSES){
        endRound(false);
        return;
      }
    }

    function skipWord(){
      if(locked) return;
      misses = clamp(misses + 1, 0, MAX_MISSES);
      streak = 0;
      setMessage("warn", `Você pulou. Penalidade: +1 erro (restam ${MAX_MISSES - misses}). Streak zerou.`);

      if(misses >= MAX_MISSES){
        endRound(false);
      } else {
        resetRound(true);
      }
    }

    function giveUp(){
      if(locked) return;
      const loss = SCORE.giveUpCost + 3*entry.d;
      score -= loss;
      streak = 0;
      misses = MAX_MISSES;

      if(score > best){
        best = score;
        localStorage.setItem(bestKey, String(best));
      }

      setMessage("bad", `Desistiu. -${loss} pts. A palavra era: ${answerShown}.`);
      endRound(false);
    }

    function handleKeydown(e){
      if(overlay.classList.contains("show")){
        if(e.key === "Escape") hideOverlay();
        if(e.key === "Enter") nextRoundFromOverlay();
        return;
      }

      if(e.key === "Enter" && locked){
        nextRound();
        return;
      }
      if(e.key === "Escape"){
        return;
      }

      const k = e.key.toUpperCase();
      if(/^[A-Z0-9]$/.test(k)){
        tryGuess(k);
      }
    }

    function nextRound(){
      hideOverlay();
      resetRound(true);
      setMessage("warn", `Nova rodada! Você tem ${MAX_MISSES} tentativas. Boa sorte.`);
    }

    function nextRoundFromOverlay(){
      if(!overlay.classList.contains("show")) return;
      nextRound();
    }

    // ===== eventos =====
    btnSkip.addEventListener("click", skipWord);
    btnNew.addEventListener("click", startNewGame);
    btnGiveUp.addEventListener("click", giveUp);

    ovClose.addEventListener("click", hideOverlay);
    ovNext.addEventListener("click", nextRoundFromOverlay);
    overlay.addEventListener("click", (e)=>{
      if(e.target === overlay) hideOverlay();
    });

    document.addEventListener("keydown", handleKeydown);

    // ===== init =====
    elMaxMisses.textContent = MAX_MISSES;
    elBest.textContent = best;
    startNewGame();
  </script>
</body>
</html>